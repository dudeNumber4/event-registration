@page "/register"

@using EventRegistration.Services
@using EventRegistration.ViewModels
@inject RegistrantService RegistrantService
@inject NavigationManager NavigationManager

<h3>Register</h3>
<EditForm class="form-group" Model="model">
    <div class="container">
        <div class="row row-padding">
            <label for="firstName">First Name</label>
            <InputText id="firstName" type="text" class="form-control" placeholder="First Name" @bind-Value="model.Registrant.PersonalInfo.FirstName"></InputText>
        </div>
        <div class="row row-padding">
            <label for="lastName">Last Name</label>
            <InputText id="lastName" type="text" class="form-control" placeholder="Last Name" @bind-Value="model.Registrant.PersonalInfo.LastName"></InputText>
        </div>
        <div class="row row-padding">
            <label for="email">Email address</label>
            <InputText id="email" type="email" class="form-control" placeholder="Enter email" @bind-Value="model.Registrant.PersonalInfo.Email"></InputText>
        </div>
        <div class="row row-padding">
            <label for="organization">Organization</label>
            <InputText id="organization" type="text" class="form-control" placeholder="Enter Organization" @bind-Value="model.Registrant.EmploymentInfo.OrgName"></InputText>
        </div>
        <div class="row row-padding">
            <label for="industry">Industry</label>
            <InputText id="industry" type="text" class="form-control" placeholder="Enter Industry" @bind-Value="model.Registrant.EmploymentInfo.Industry"></InputText>
        </div>
        <div class="row row-padding">
            <button class="btn btn-primary" @onclick="@(() => RegisterYo())">Submit</button>
        </div>
        <div class="row row-padding">
            @if (!string.IsNullOrEmpty(model.ValidationMsg))
            {
                <div class="alert alert-warning" role="alert">
                    @model.ValidationMsg
                </div>
            }
        </div>
    </div>
</EditForm>

@code {
    private RegisterViewModel model;

    async void RegisterYo()
    {
        if (await model.Register())
        {
            RegistrantService.CurrentRegistrant = model.Registrant;
            // Create registration
            NavigationManager.NavigateTo($"edit-registration/{model.Registrant.Id}");
        }
        // else validation message should show.
    }

    protected override void OnInitialized()
    {
        model = new(RegistrantService);
    }
}
